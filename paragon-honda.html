<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheet CSV Data Viewer (Full Width)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        /* Custom CSS for button hover effect */
        .nav-btn {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 2px, 4px, 0.1);
        }
        .nav-btn:hover:not(:disabled) {
            box-shadow: 0 10px 15px -3px rgba(49, 46, 129, 0.3), 0 4px 6px -4px rgba(49, 46, 129, 0.2);
            transform: translateY(-2px);
        }
        .nav-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* Full width layout */
        .data-viewer-container {
            width: 100%;
            max-width: 100%;
            padding: 0;
        }
        /* Single row for details */
        .details-row {
            display: flex;
            overflow-x: auto;
            padding: 8px 0;
            gap: 8px;
            width: 100%;
        }
        .detail-item {
            flex: 0 0 auto;
            min-width: 150px;
            max-width: 200px;
        }
        /* Full width for embed container with no padding */
        .embed-container {
            width: 100%;
            padding: 0;
            margin: 0;
        }
        .embed-container iframe, .embed-container img {
            width: 100%;
            border-radius: 0;
        }
        /* Custom scrollbar for horizontal details */
        .details-row::-webkit-scrollbar {
            height: 8px;
        }
        .details-row::-webkit-scrollbar-track {
            background: #f0f4ff;
            border-radius: 4px;
        }
        .details-row::-webkit-scrollbar-thumb {
            background-color: #c7d2fe;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-0">

    <div class="data-viewer-container bg-white rounded-none shadow-2xl p-0 flex flex-col space-y-0">
        
        <h1 class="text-3xl font-extrabold text-center text-indigo-700 border-b-2 pb-3 pt-6 px-6">
            Full Width Data Viewer
        </h1>

        <!-- Loading / Error Message -->
        <div id="status-display" class="p-4 bg-indigo-100 text-indigo-800 text-center font-medium mx-6 mt-4 rounded-lg">
            Loading data from Google Sheet...
        </div>

        <!-- Data Card -->
        <div id="data-card" class="hidden border-0 p-0 bg-white">
            
            <!-- FIRST BLOCK: All non-URL/Image details in a single horizontal row -->
            <div id="detail-fields" class="details-row border-b-2 border-indigo-100 px-6 py-4">
                <!-- Non-URL fields will be inserted here -->
            </div>
            
            <!-- SECOND BLOCK: Embedded Content (Only the first URL/Image found) -->
            <div id="embed-content" class="embed-container">
                <!-- Embedded content will be inserted here -->
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="flex justify-between items-center p-6 bg-gray-50 mt-4">
            <button id="prev-btn" onclick="previousRow()" disabled
                class="nav-btn bg-gray-300 text-gray-800 p-3 rounded-xl font-semibold transition duration-300 hover:bg-gray-400 disabled:shadow-none disabled:transform-none">
                &larr; Previous
            </button>

            <span id="counter" class="text-lg font-medium text-indigo-600">
                0 of 0
            </span>
            
            <button id="next-btn" onclick="nextRow()" disabled
                class="nav-btn bg-indigo-600 text-white p-3 rounded-xl font-semibold transition duration-300 hover:bg-indigo-700 disabled:shadow-none disabled:transform-none">
                Next &rarr;
            </button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2w83bmtTlnAjxBQIx1r1mYvZwvwX0lneW6MWxF-4kNQ-Gf4Gv1KdsQEbXW7aFdgF-dHV8YUuCrI9s/pub?gid=0&single=true&output=csv';

        // --- State Variables ---
        let data = [];
        let currentIndex = 0;

        // --- DOM Elements ---
        const statusDisplay = document.getElementById('status-display');
        const dataCard = document.getElementById('data-card');
        const detailFieldsContainer = document.getElementById('detail-fields');
        const embedContentContainer = document.getElementById('embed-content');
        const counterSpan = document.getElementById('counter');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // --- Helper Function: CSV to JSON Parser (Simple) ---
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return [];

            const headers = lines[0].split(',').map(header => header.trim());
            const records = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim());
                if (values.length === headers.length) {
                    const record = {};
                    headers.forEach((header, index) => {
                        record[header] = values[index];
                    });
                    records.push(record);
                }
            }
            return records;
        }

        // --- Core Rendering Function ---
        function renderCurrentRow() {
            if (data.length === 0) return;

            const record = data[currentIndex];
            detailFieldsContainer.innerHTML = ''; // Clear details
            embedContentContainer.innerHTML = ''; // Clear embed

            let urlFound = false;

            // --- FIRST PASS: Render all NON-URL fields in a single row ---
            for (const key in record) {
                const value = record[key];

                // Check if the value is a URL
                if (value && value.startsWith('http')) {
                    continue; // Skip URLs in this pass
                }

                if (value) {
                    const fieldDiv = document.createElement('div');
                    fieldDiv.className = 'detail-item flex flex-col p-2 bg-gray-50 rounded-lg border border-gray-200';
                    
                    // Field Label (Key)
                    const label = document.createElement('span');
                    label.className = 'text-xs font-semibold text-gray-500 uppercase tracking-wider truncate';
                    label.textContent = key;
                    
                    // Field Value (Data)
                    const displayValue = document.createElement('span');
                    displayValue.className = 'text-sm font-bold text-gray-800 truncate';
                    displayValue.textContent = value;
                    
                    fieldDiv.appendChild(label);
                    fieldDiv.appendChild(displayValue);
                    detailFieldsContainer.appendChild(fieldDiv);
                }
            }
            
            // --- SECOND PASS: Find and Render ONLY THE FIRST URL (Embed) ---
            for (const key in record) {
                const value = record[key];

                // Process only if it's a URL and we haven't found one yet
                if (value && value.startsWith('http') && !urlFound) {
                    
                    const isImage = /\.(jpeg|jpg|png|gif|webp)$/i.test(value.toLowerCase());
                    
                    const embedContainer = document.createElement('div');
                    embedContainer.className = 'embed-container';

                    const fieldHeader = document.createElement('p');
                    fieldHeader.className = 'text-lg font-bold text-gray-700 mb-2 border-b pb-1 px-6 pt-4';
                    fieldHeader.textContent = `Embedded Content: ${key}`;
                    embedContentContainer.appendChild(fieldHeader);
                    
                    const displayValue = document.createElement('div');
                    displayValue.className = 'w-full';
                    
                    if (isImage) {
                        // 1. Display as an Image
                        const img = document.createElement('img');
                        img.src = value;
                        img.alt = key;
                        img.className = 'w-full h-auto';
                        displayValue.appendChild(img);
                    } else {
                        // 2. Embed as an Iframe (General Website URL)
                        
                        // Add warning about embedding limitations
                        const warning = document.createElement('p');
                        warning.className = 'mt-2 mb-2 p-2 text-xs bg-yellow-100 text-yellow-800 rounded-md font-medium border border-yellow-300 mx-6';
                        warning.innerHTML = `⚠️ **Embedding Attempt:** URL from column **"${key}"** is being loaded in an iframe. If content is blank, the external website security policy (X-Frame-Options) is likely blocking the embed.`;
                        displayValue.appendChild(warning);
                        
                        // Iframe container for height control
                        const iframeContainer = document.createElement('div');
                        iframeContainer.className = 'w-full h-80 overflow-hidden mt-2';
                        
                        // The Iframe element
                        const iframe = document.createElement('iframe');
                        iframe.src = value;
                        iframe.title = key;
                        iframe.className = 'w-full h-full';
                        iframe.setAttribute('frameborder', '0');
                        iframe.setAttribute('allowfullscreen', 'true');
                        
                        iframeContainer.appendChild(iframe);
                        displayValue.appendChild(iframeContainer);

                        // Also display the clickable link as a fallback
                        const link = document.createElement('a');
                        link.href = value;
                        link.textContent = `Open Full Link (${key}) in New Tab`;
                        link.target = '_blank';
                        link.className = 'block mt-2 text-sm text-blue-600 hover:text-blue-800 underline px-6 pb-4';
                        displayValue.appendChild(link);
                    }
                    
                    embedContainer.appendChild(displayValue);
                    embedContentContainer.appendChild(embedContainer);
                    
                    urlFound = true; // Stop after finding the first URL
                    break;
                }
            }
            
            // If no URL was found, display a message in the content area
            if (!urlFound) {
                 embedContentContainer.innerHTML = `<div class="p-4 text-center text-gray-500 italic">No image or web link found in the current row.</div>`;
            }

            // Update UI state
            updateNavigation();
        }

        // --- Navigation Logic ---
        function updateNavigation() {
            const total = data.length;
            counterSpan.textContent = `${currentIndex + 1} of ${total}`;

            // Disable buttons at boundaries
            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= total - 1;

            // Apply Tailwind classes for appearance
            if (prevBtn.disabled) {
                prevBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                prevBtn.classList.add('bg-gray-300', 'text-gray-800');
            } else {
                prevBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                prevBtn.classList.remove('bg-gray-300', 'text-gray-800');
            }

            if (nextBtn.disabled) {
                nextBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.add('bg-gray-300', 'text-gray-800');
            } else {
                nextBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.remove('bg-gray-300', 'text-gray-800');
            }
        }

        function nextRow() {
            if (currentIndex < data.length - 1) {
                currentIndex++;
                renderCurrentRow();
            }
        }

        function previousRow() {
            if (currentIndex > 0) {
                currentIndex--;
                renderCurrentRow();
            }
        }

        // --- Initialization ---
        async function initializeApp() {
            try {
                // Implementing exponential backoff for the fetch call
                let response = null;
                const maxRetries = 3;
                let delay = 1000;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(CSV_URL);
                        if (response.ok) break;
                    } catch (e) {
                        // Suppress console error on retry attempt, but log if max retries reached
                        if (i === maxRetries - 1) throw e;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                }

                if (!response || !response.ok) {
                    throw new Error(`HTTP error! status: ${response ? response.status : 'No response after retries'}`);
                }
                const csvText = await response.text();
                
                // Parse the data
                const parsedData = parseCSV(csvText);
                
                if (parsedData.length === 0) {
                    statusDisplay.textContent = 'Error: The CSV file is empty or could not be parsed correctly.';
                    statusDisplay.classList.replace('bg-indigo-100', 'bg-red-100');
                    statusDisplay.classList.replace('text-indigo-800', 'text-red-800');
                    return;
                }
                
                data = parsedData;
                currentIndex = 0; // Start at the first record
                
                // Hide status and show data card
                statusDisplay.classList.add('hidden');
                dataCard.classList.remove('hidden');

                // Render the first record
                renderCurrentRow();

            } catch (error) {
                console.error("Failed to load or parse data:", error);
                statusDisplay.textContent = `Failed to load data: ${error.message}. Please check the URL and ensure the Google Sheet is published to the web.`;
                statusDisplay.classList.replace('bg-indigo-100', 'bg-red-100');
                statusDisplay.classList.replace('text-indigo-800', 'text-red-800');
            }
        }

        // Global functions for button clicks
        window.nextRow = nextRow;
        window.previousRow = previousRow;
        
        // Start the application when the page loads
        initializeApp();

    </script>
</body>
</html>
