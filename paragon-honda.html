<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Width Data Viewer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        /* Full width layout */
        .data-viewer-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Detail row - full width, reduced height, sticky */
        .details-row {
            display: flex;
            overflow-x: auto;
            padding: 8px 12px;
            gap: 10px;
            width: 100%;
            min-height: 50px;
            background: white;
            z-index: 20;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .detail-item {
            flex: 0 0 auto;
            min-width: 140px;
            max-width: 200px;
        }
        /* Full width for embed container with no padding */
        .embed-container {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            position: relative;
        }
        .embed-container iframe, .embed-container img {
            width: 100%;
            height: 100%;
            border-radius: 0;
        }
        /* Floating navigation buttons */
        .floating-nav {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 30;
            pointer-events: none;
        }
        .floating-nav button {
            pointer-events: all;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .floating-nav button:hover:not(:disabled) {
            box-shadow: 0 6px 16px rgba(49, 46, 129, 0.4);
            transform: translateY(-2px);
        }
        /* Custom scrollbar for horizontal details */
        .details-row::-webkit-scrollbar {
            height: 6px;
        }
        .details-row::-webkit-scrollbar-track {
            background: #f0f4ff;
            border-radius: 3px;
        }
        .details-row::-webkit-scrollbar-thumb {
            background-color: #c7d2fe;
            border-radius: 3px;
        }
        /* Status and counter styling */
        .status-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #e0e7ff;
            border-bottom: 1px solid #c7d2fe;
        }
    </style>
</head>
<body class="bg-gray-100 p-0 m-0">

    <div class="data-viewer-container bg-white">
        
        <!-- Status and Counter Row -->
        <div class="status-container">
            <h1 class="text-xl font-bold text-indigo-700">
               Paragon Honda
            </h1>
            <span id="counter" class="text-base font-medium text-indigo-600">
                0 of 0
            </span>
        </div>

        <!-- Loading / Error Message -->
        <div id="status-display" class="p-3 bg-indigo-100 text-indigo-800 text-center font-medium">
            Loading data from Google Sheet...
        </div>

        <!-- Data Card -->
        <div id="data-card" class="hidden flex-1 flex flex-col">
            
            <!-- FIRST BLOCK: All non-URL/Image details in a single horizontal row - full width -->
            <div id="detail-fields" class="details-row">
                <!-- Non-URL fields will be inserted here -->
            </div>
            
            <!-- SECOND BLOCK: Embedded Content (Only the first URL/Image found) -->
            <div id="embed-content" class="embed-container flex-1">
                <!-- Embedded content will be inserted here -->
            </div>
            
            <!-- Floating Navigation Controls -->
            <div class="floating-nav">
                <button id="prev-btn" onclick="previousRow()" disabled
                    class="bg-gray-300 text-gray-800 p-3 rounded-full font-semibold transition duration-300 hover:bg-gray-400 disabled:opacity-50 disabled:shadow-none disabled:transform-none">
                    &larr;
                </button>
                
                <button id="next-btn" onclick="nextRow()" disabled
                    class="bg-indigo-600 text-white p-3 rounded-full font-semibold transition duration-300 hover:bg-indigo-700 disabled:opacity-50 disabled:shadow-none disabled:transform-none">
                    &rarr;
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2w83bmtTlnAjxBQIx1r1mYvZwvwX0lneW6MWxF-4kNQ-Gf4Gv1KdsQEbXW7aFdgF-dHV8YUuCrI9s/pub?gid=0&single=true&output=csv';

        // --- State Variables ---
        let data = [];
        let currentIndex = 0;

        // --- DOM Elements ---
        const statusDisplay = document.getElementById('status-display');
        const dataCard = document.getElementById('data-card');
        const detailFieldsContainer = document.getElementById('detail-fields');
        const embedContentContainer = document.getElementById('embed-content');
        const counterSpan = document.getElementById('counter');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // --- Helper Function: CSV to JSON Parser (Simple) ---
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return [];

            const headers = lines[0].split(',').map(header => header.trim());
            const records = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim());
                if (values.length === headers.length) {
                    const record = {};
                    headers.forEach((header, index) => {
                        record[header] = values[index];
                    });
                    records.push(record);
                }
            }
            return records;
        }

        // --- Core Rendering Function ---
        function renderCurrentRow() {
            if (data.length === 0) return;

            const record = data[currentIndex];
            detailFieldsContainer.innerHTML = ''; // Clear details
            embedContentContainer.innerHTML = ''; // Clear embed

            let urlFound = false;

            // --- FIRST PASS: Render all NON-URL fields in a single row - full width ---
            for (const key in record) {
                const value = record[key];

                // Check if the value is a URL
                if (value && value.startsWith('http')) {
                    continue; // Skip URLs in this pass
                }

                if (value) {
                    const fieldDiv = document.createElement('div');
                    fieldDiv.className = 'detail-item flex flex-row items-center p-2 bg-gray-50 rounded border border-gray-200';
                    
                    // Field Label (Key)
                    const label = document.createElement('span');
                    label.className = 'text-xs font-semibold text-gray-500 uppercase truncate mr-2';
                    label.textContent = key + ':';
                    
                    // Field Value (Data)
                    const displayValue = document.createElement('span');
                    displayValue.className = 'text-sm font-bold text-gray-800 truncate';
                    displayValue.textContent = value;
                    
                    fieldDiv.appendChild(label);
                    fieldDiv.appendChild(displayValue);
                    detailFieldsContainer.appendChild(fieldDiv);
                }
            }
            
            // --- SECOND PASS: Find and Render ONLY THE FIRST URL (Embed) ---
            for (const key in record) {
                const value = record[key];

                // Process only if it's a URL and we haven't found one yet
                if (value && value.startsWith('http') && !urlFound) {
                    
                    const isImage = /\.(jpeg|jpg|png|gif|webp)$/i.test(value.toLowerCase());
                    
                    const embedContainer = document.createElement('div');
                    embedContainer.className = 'embed-container';

                    const displayValue = document.createElement('div');
                    displayValue.className = 'w-full h-full';
                    
                    if (isImage) {
                        // 1. Display as an Image
                        const img = document.createElement('img');
                        img.src = value;
                        img.alt = key;
                        img.className = 'w-full h-full object-contain bg-black';
                        displayValue.appendChild(img);
                    } else {
                        // 2. Embed as an Iframe (General Website URL)
                        
                        // Iframe container for height control
                        const iframeContainer = document.createElement('div');
                        iframeContainer.className = 'w-full h-full overflow-hidden';
                        
                        // The Iframe element
                        const iframe = document.createElement('iframe');
                        iframe.src = value;
                        iframe.title = key;
                        iframe.className = 'w-full h-full';
                        iframe.setAttribute('frameborder', '0');
                        iframe.setAttribute('allowfullscreen', 'true');
                        
                        iframeContainer.appendChild(iframe);
                        displayValue.appendChild(iframeContainer);
                    }
                    
                    embedContainer.appendChild(displayValue);
                    embedContentContainer.appendChild(embedContainer);
                    
                    urlFound = true; // Stop after finding the first URL
                    break;
                }
            }
            
            // If no URL was found, display a message in the content area
            if (!urlFound) {
                 embedContentContainer.innerHTML = `<div class="w-full h-full flex items-center justify-center text-gray-500 italic bg-gray-100">No image or web link found in the current row.</div>`;
            }

            // Update UI state
            updateNavigation();
        }

        // --- Navigation Logic ---
        function updateNavigation() {
            const total = data.length;
            counterSpan.textContent = `${currentIndex + 1} of ${total}`;

            // Disable buttons at boundaries
            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= total - 1;

            // Apply Tailwind classes for appearance
            if (prevBtn.disabled) {
                prevBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                prevBtn.classList.add('bg-gray-300', 'text-gray-800');
            } else {
                prevBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                prevBtn.classList.remove('bg-gray-300', 'text-gray-800');
            }

            if (nextBtn.disabled) {
                nextBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.add('bg-gray-300', 'text-gray-800');
            } else {
                nextBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.remove('bg-gray-300', 'text-gray-800');
            }
        }

        function nextRow() {
            if (currentIndex < data.length - 1) {
                currentIndex++;
                renderCurrentRow();
            }
        }

        function previousRow() {
            if (currentIndex > 0) {
                currentIndex--;
                renderCurrentRow();
            }
        }

        // --- Initialization ---
        async function initializeApp() {
            try {
                // Implementing exponential backoff for the fetch call
                let response = null;
                const maxRetries = 3;
                let delay = 1000;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(CSV_URL);
                        if (response.ok) break;
                    } catch (e) {
                        // Suppress console error on retry attempt, but log if max retries reached
                        if (i === maxRetries - 1) throw e;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                }

                if (!response || !response.ok) {
                    throw new Error(`HTTP error! status: ${response ? response.status : 'No response after retries'}`);
                }
                const csvText = await response.text();
                
                // Parse the data
                const parsedData = parseCSV(csvText);
                
                if (parsedData.length === 0) {
                    statusDisplay.textContent = 'Error: The CSV file is empty or could not be parsed correctly.';
                    statusDisplay.classList.replace('bg-indigo-100', 'bg-red-100');
                    statusDisplay.classList.replace('text-indigo-800', 'text-red-800');
                    return;
                }
                
                data = parsedData;
                currentIndex = 0; // Start at the first record
                
                // Hide status and show data card
                statusDisplay.classList.add('hidden');
                dataCard.classList.remove('hidden');

                // Render the first record
                renderCurrentRow();

            } catch (error) {
                console.error("Failed to load or parse data:", error);
                statusDisplay.textContent = `Failed to load data: ${error.message}. Please check the URL and ensure the Google Sheet is published to the web.`;
                statusDisplay.classList.replace('bg-indigo-100', 'bg-red-100');
                statusDisplay.classList.replace('text-indigo-800', 'text-red-800');
            }
        }

        // Global functions for button clicks
        window.nextRow = nextRow;
        window.previousRow = previousRow;
        
        // Start the application when the page loads
        initializeApp();

    </script>
</body>
</html>
